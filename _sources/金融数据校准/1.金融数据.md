# SimLOB

## Learning Representations of Limited Order Book for Financial Market Simulation

文章可以参考{cite:p}`li2024simlob`.

## 限价订单簿 LOB



# NewLOB

## 对LOB数据理解
在SimLOB中, 作者使用MSE作为目标函数训练模型和校准数据, 即认为LOB中的所有数据具有同样的重要性. 

然而, 事实上LOB中的数据的重要性显然有很大的区别. 
    1. 金融预测相关工作中, 预测金融数据的价格走向( 如, 中间价 ) 占据多数, 可见在LOB中, 一档买卖价量是最重要的特征, 其他档位买卖价量重要性依次递减, 也正因为如此, 所有证券交易市场中必定会提供一档买卖价量供投资者参考,而更多档位的价量则是选择性地提供(可能需要额外的费用或权限). 
    2. 与强化学习中的回报函数类似, 时间越久远的LOB的价值越低, 对于预测金融曲线走向的作用越小, 因此, 在校准过程中单纯的将所有时间步上的LOB数据做MSE也不符合时序数据的这种特征.

综上, 把所有特征一视同仁, 简单地使用MSE作为训练目标显然不是金融背景下地最优选择.

```{admonition} 实验:
:class: tip

1. 为不同特征值人工设置权重参数, 希望训练得到的模型可以抓住数据的主要特征(如一档买卖价量数据)
2. 为不同时间步上的特征添加折扣参数, 让模型倾向于对齐最近的数据, 而放松对历史数据的约束.

```

## NewLOB数据结构

如前所述, 简单地使用MSE判断两个LOB之间的差异是不充分的, 甚至可能是错误的. 理由如下:

1. LOB中的量实际上是价的一个属性, 在MSE中, 只是衡量了相同档位 (而不是相同价格下) 的量的差异, 这个减法在现实中是没有意义的.
2. 不同档位的数据的重要程度是不一样的, 将所有的特征一视同仁直接计算MSE的直接后果是让模型没有重点, 加大了训练难度(模型更难收敛)和所需计算资源.
3. 价和量的重要程度也是不一样的, 价量是不同的单位, 即使在经过归一化处理之后, MSE没有考虑这种差异性.

LOB数据是由订单数据叠加形成的, 本质上是对订单数据的聚合, 任意两个LOB之间的差异都可以视为由若干订单叠加产生的. 证明也很直观, 任何LOB都可以通过下相反的订单消除所有的价量档位到达0的初始状态, 再通过下对应的订单到达另一个LOB. 这些订单可以是很多的小订单( 现实情况下就是如此, 基于Agent的金融模拟器也是)构成的, 如果忽略订单到达的时间步和投资者个体, 可以将相同价位和方向的订单聚合为一个大订单. 这样, 两个LOB之间的订单差就可以唯一确定下来. 

```{admonition} LOB的订单距离: 订单差
:class: note

举例:

1. 两个完全不一致(买卖价全都不一样)的十档LOB至少需要40个聚合订单达成, 将这些订单按照价和买卖方向排列, 就唯一确定了LOB之间的订单差异. 

2. 假设LOB2 由 LOB1 通过若干订单买空一档形成. 那么两个LOB之间的订单差就是一个聚合订单, 该订单的买价为卖一档价, 量等于卖一档的总量. 其他的档位因为价量相同相减之后为0. 即订单差真实反映了两个LOB之间的距离.

```










