# 趋势预测

## 问题定义

使用LOB数据预测股票数据未来走势, FI-2010数据集被很多论文使用, 在最近发表的金融时序数据处理的Benchmark中也是用了FI-2010数据集作为其3个数据集之一. 

该数据集数据形状为(149,时序数), 即每一行代表一个特征, 每一列代表一个时间点. 同时, 该数据集的原始论文中提到了他们处理原始LOB数据的几种归一化方法包括Z-score, Maxmin和DecPre方法. 但是该作者使用的是按行归一化. 这也导致了数据集出现了严重问题, 因为按行归一化之后, 每一列数据(即一个LOB)之间的数据关系出现了混乱, 比如卖1价比卖2价更高, 或者类似的问题. 这种归一化方法使得LOB的逻辑性被打破, 使原本可以准确表征LOB的模型(重构MSELoss低于1e-4)难以在该数据集上达到预期效果. 

该数据集对LOB数据的处理时完全没有考虑数据的金融属性, 而是生硬地按照机器学习的通用方法处理, 导致地结果就是预测结果毫无意义只是在记住训练集中地数据模式而已. 原因如下, 
1. 在数据处理地过程中, 前面地时序数据使用了基于该特征地后续数据统计值, 以一档买价为例, 如果该价格低于0, 表示目前一档买价在均值以下, 那么未来看涨的可能性就更高, 反之则低. 这个对未来数据的统计值在实际中是无法获得的. 那么模型可能无法准确地基于过去的归一化数据来预测未来的值. 
2. 按行归一化更大的问题是, 它让每个时间步的数据毫无意义, 代表LOB的单步时间中, 各个数据之间失去了逻辑性(买卖价档位的大小的约束关系被打破), 对于自编码器来说, 就需要更多的隐藏变量来记住其关系, 这对于压缩LOB数据维度毫无作用.

一个更适合的数据预处理方法是,对所有的价(量)数据做统一的归一化, 这样归一化之后的数据也能保持单个LOB中的大小关系. 另一方面, 对于新给的LOB数据, 只要知道是来自哪支股票, 就可以用该股票的历史数据(价量总的均值和方差)来进行处理, 相比每一行的统计数据, 总统计量包含更少的对未来数据的假设, 可以看作对应的这支股票的上下文信息, 从而取得更好的预测结果. 

对于原文作者采用的几种归一化方法(主要讨论Z-score和Minmax), 我认为Z-score是更好:
1. Z-score对于数据取值的范围更宽, 能体现更多的股市价格变动情况.
2. Minmax在没有特殊处理时, 只能表示历史数据中Min-Max之间的数据, 如果预测数据(如果需要预测LOB而不仅仅是趋势的化)超出这个值, 模型也无法给出正确的预测. 